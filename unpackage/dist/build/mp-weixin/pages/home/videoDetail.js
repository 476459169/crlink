(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/home/videoDetail"],{"040d":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,n=function(){i.e("components/uni-popup/uni-popup-message").then(function(){return resolve(i("e916"))}.bind(null,i)).catch(i.oe)},a=function(){i.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(i("7a33"))}.bind(null,i)).catch(i.oe)},r=function(){i.e("components/uni-popup/uni-popup-share").then(function(){return resolve(i("a4b4"))}.bind(null,i)).catch(i.oe)},s=null,l={components:{uniPopupMessage:n,uniPopupDialog:a,uniPopupShare:r},data:function(){return{src:"",couserID:"",collegeId:"",selectIndex:0,itemSelectIndex:0,itemSelectClass:"courserItems_style",myData:Object,quesArr:[],videoUrl:"",autoPlay:!1,baseUrl:"http://39.105.48.243:8080/crlink/",loading:"加载更多",page:1,replyItem:Object,replyUserid:"",videoLastTime:0,videoItem:Object,playtime:"",seekTime:0,iscollect:0,testArr:[]}},onLoad:function(e){o=this,this.couserID=e.courseID,this.collegeId=e.collegeId,this.baseUrl=getApp().globalData.baseUrl},onShow:function(){this.getNetMessage(),this.getQues(this.page),this.getExamList()},onHide:function(){this.uploadVideoPlayTime("NO")},onUnload:function(){this.uploadVideoPlayTime("NO")},computed:{itemSelect1:function(){return{selected:0==this.selectIndex,normal:0!=this.selectIndex}},itemSelect2:function(){return{selected:1==this.selectIndex,normal:1!=this.selectIndex}},itemSelect3:function(){return{selected:2==this.selectIndex,normal:2!=this.selectIndex}},courseSelct:function(){return{}}},onReady:function(t){this.videoContext=e.createVideoContext("myVideo")},onPullDownRefresh:function(){e.stopPullDownRefresh()},onReachBottom:function(){null!=s&&clearTimeout(s),s=setTimeout((function(){o.getQues(o.page)}),600)},methods:{vedioTimeUpDate:function(e){this.seekTime>0?(this.videoLastTime=this.seekTime,this.videoContext.seek(this.seekTime),this.seekTime=0):parseInt(e.detail.currentTime)-parseInt(this.videoLastTime)>3||parseInt(this.videoLastTime)-parseInt(e.detail.currentTime)>3?this.videoContext.seek(this.videoLastTime):this.videoLastTime=e.detail.currentTime},videoErrorCallback:function(t){e.showModal({content:t.target.errMsg,showCancel:!1})},videoEnd:function(e){this.uploadVideoPlayTime("YES")},getNetMessage:function(){var t=e.getStorageSync("loginKey");this.$api.post("index!ajaxGetCourseDetailNew.action",{id:o.couserID,loginKey:t}).then((function(e){if(0==e.res.status){o.myData=e.inf,o.videoItem=e.inf.parts[0],console.log("112233"),o.seekTime=e.inf.curPartPlayDuration;var t=e.inf.curPartNum,i=t.toInteger();console.log("partnum = "+i+"seektime="+o.videoLastTime),o.itemSelectIndex=i-1,o.videoItem=e.inf.parts[i-1],2==e.inf.viewType&&1==e.inf.isBuy?o.autoPlay=!0:0==e.inf.viewType&&(o.autoPlay=!1)}}))},getQues:function(t){var i=e.getStorageSync("loginKey");this.$api.post("live!ajaxGetCourseQuestion.action",{id:o.couserID,loginKey:i,firstIndex:t.toString()}).then((function(i){if(0==i.res.status){if(1==t){var n=i.inf.arr;n.forEach((function(e){e.replyArr||(e.replyArr=[]),o.quesArr.push(e)})),console.log("ques="+n),o.page++}else t<=i.inf.pageCount&&(console.log("ques= "+o.quesArr),o.quesArr=o.quesArr.concat(i.inf.arr),o.page++,o.loading="加载更多");e.hideNavigationBarLoading(),e.stopPullDownRefresh()}}))},addQues:function(t){var i=e.getStorageSync("loginKey");this.$api.post("live!ajaxAddCourseQuestion.action",{detail:t,loginKey:i,partId:o.myData.parts[0].partId}).then((function(t){console.log("addques="+t.res.status),0==t.res.status?(console.log("addQues1= "+t),e.showToast({title:"提交成功"}),o.quesArr=[],o.page=1,o.getQues(o.page)):e.showModal({title:"提交失败"})}))},reply:function(t,i,n){console.log("zhiqian = "+o.replyItem.replyArr+o.quesArr);var a=e.getStorageSync("loginKey");this.$api.post("live!ajaxAddCourseQuestionReply.action",{detail:n,loginKey:a,partId:o.myData.parts[0].partId,id:t.id,replyId:i||t.id,replyUserId:i||""}).then((function(t){0==t.res.status?(e.showToast({title:"提交成功"}),o.replyUserid="",o.replyItem.replyArr=t.inf.replyArr,console.log("zhihou="+o.replyItem.replyArr+o.quesArr)):e.showModal({title:"提交失败"})}))},uploadVideoPlayTime:function(t){var i=parseInt(this.videoLastTime)%60,n=parseInt(this.videoLastTime)/60,a=parseInt(n)>0?parseInt(n).toString()+"分":i.toString()+"秒/"+o.videoItem.timeStr,r=e.getStorageSync("loginKey"),s=e.getStorageSync("userId");this.$api.post("index!ajaxAddCourseRecordHistory.action",{loginKey:r,userId:s,courseId:o.myData.id,partNum:o.videoItem.partTitle,coursePartId:o.videoItem.partId,teacherName:o.myData.author,partPlayDuration:parseInt(o.videoLastTime),isCompleted:t,playTime:a,imgUrl:o.myData.imgUrl,courseTitle:o.myData.title,watchVideoDuration:""}).then((function(t){0==t.res.status?(o.replyUserid="",o.replyItem.replyArr=t.inf.replyArr,console.log("zhihou="+o.replyItem.replyArr+o.quesArr)):e.showModal({title:"提交失败"})}))},commentClick:function(){o.videoContext.pause(),e.navigateTo({url:"./VdoDetail/VideoDetailcomment?courseID="+o.couserID})},likeClick:function(){var t=e.getStorageSync("loginKey");this.$api.post("index!ajaxCollectCourse.action",{loginKey:t,id:o.couserID}).then((function(t){0==t.res.status?o.myData.isCollect=1==t.inf.isColl?0:1:e.showModal({title:"提交失败"})}))},shareClick:function(){console.log("shareClick"),e.share({provider:"weixin",scene:"WXSceneSession",type:5,imageUrl:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/app/share-logo@3.png",title:"欢迎体验uniapp",miniProgram:{id:"gh_19f4ac0477a4",path:"pages/home/home",type:0,webUrl:"http://uniapp.dcloud.io"},success:function(e){console.log(JSON.stringify(e))}})},tobuy:function(){0==this.myData.isBuy&&e.navigateTo({url:"./payView/payView?courseId="+o.couserID})},itemSelect:function(e){this.selectIndex=e,2==e&&this.getExamList()},getExamList:function(){var t=e.getStorageSync("loginKey");this.$api.post("college!ajaxGetCoursePartExamList.action",{loginKey:t,courseId:this.couserID}).then((function(t){0==t.res.status?o.testArr=t.inf.arr:e.showModal({title:t.res.errMsg})}))},collegeItemClick:function(t){o.videoContext.pause(),e.navigateTo({url:"./college?collegeId="+t.collegeId})},moreClick:function(t){console.log("str = "+t),o.videoContext.pause(),e.navigateTo({url:"./moreCollege?id="+t})},courseItemsSelct:function(e,t){this.itemSelectIndex!==e&&(this.videoLastTime=0,this.itemSelectIndex=e,console.log("e="+e+"videourl = "+this.myData.parts[e].videoUrl),this.videoItem=t)},vdoPlay:function(){2==this.myData.viewType&&0==this.myData.isBuy&&(e.showModal({title:"购买后继续观看",content:"是否跳转购买？",success:function(e){e.confirm?console.log("tobuy"):e.cancel&&console.log("用户点击取消")}}),this.timer=setInterval((function(){o.videoContext.pause(),clearInterval(o.timer)}),500))},vdopause:function(){console.log("pause")},confirmDialog:function(){var t=e.getStorageSync("loginKey");t.length<=0?e.navigateTo({url:"../mine/login"}):this.$refs.dialogInput.open()},replyBtnClick:function(t){var i=e.getStorageSync("loginKey");i.length<=0?e.navigateTo({url:"../mine/login"}):(this.replyItem=t,this.$refs.dialogInputreply.open())},replyQueser:function(e,t){this.replyItem=e,this.replyUserid=t,this.$refs.dialogInputreply.open()},replyConfirm:function(e,t){this.reply(this.replyItem,this.replyUserid,t),e()},likeBtnClick:function(t){console.log("点赞了");var i=e.getStorageSync("loginKey");this.$api.post("index!ajaxGoodCourseQuestion.action",{loginKey:i,id:t.id}).then((function(i){0==i.res.status?(t.isGood=i.inf.goodType,o.getQues(o.page)):e.showModal({title:"点赞失败"})}))},dialogInputConfirm:function(e,t){this.addQues(t),e()}},watch:{videoItem:function(e){this.videoUrl=e.videoUrl}},filters:{formatRichText:function(e){if(e){var t=e.toString().replace(/<img[^>]*>/gi,(function(e,t){return e=e.replace(/style="[^"]+"/gi,"").replace(/style='[^']+'/gi,""),e=e.replace(/width="[^"]+"/gi,"").replace(/width='[^']+'/gi,""),e=e.replace(/height="[^"]+"/gi,"").replace(/height='[^']+'/gi,""),e}));return t=t.replace(/style="[^"]+"/gi,(function(e,t){return e=e.replace(/width:[^;]+;/gi,"max-width:100%;").replace(/width:[^;]+;/gi,"max-width:100%;"),e})),t=t.replace(/\<img/gi,'<img style="max-width:100%;height:auto;display:inline-block;margin:10rpx auto;"'),t}}}};t.default=l}).call(this,i("543d")["default"])},"2ddf":function(e,t,i){"use strict";var o={uniPopup:function(){return Promise.all([i.e("common/vendor"),i.e("components/uni-popup/uni-popup")]).then(i.bind(null,"4c04"))}},n=function(){var e=this,t=e.$createElement,i=(e._self._c,e._f("formatRichText")(e.myData.detail));e.$mp.data=Object.assign({},{$root:{f0:i}})},a=[];i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return o}))},"5cf1":function(e,t,i){"use strict";var o=i("9a3c"),n=i.n(o);n.a},7936:function(e,t,i){"use strict";(function(e){i("f645");o(i("66fd"));var t=o(i("c8b1"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("543d")["createPage"])},"9a3c":function(e,t,i){},ae70:function(e,t,i){"use strict";i.r(t);var o=i("040d"),n=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,(function(){return o[e]}))}(a);t["default"]=n.a},c8b1:function(e,t,i){"use strict";i.r(t);var o=i("2ddf"),n=i("ae70");for(var a in n)"default"!==a&&function(e){i.d(t,e,(function(){return n[e]}))}(a);i("5cf1");var r,s=i("f0c5"),l=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],r);t["default"]=l.exports}},[["7936","common/runtime","common/vendor"]]]);